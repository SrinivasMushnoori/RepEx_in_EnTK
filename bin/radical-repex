#!/usr/bin/env python

import sys

import radical.utils as ru
import radical.repex as rr


# ------------------------------------------------------------------------------
#
if __name__ == '__main__':

    # check what workload the replicas should run
    if len(sys.argv) != 2:
        print '\n\tError: missing workload\n\tUsage: %s <workload.json>\n\n'
        sys.exit(1)

    wl = ru.read_json(sys.argv[1])

    # create the required number of replicas
    replicas = list()
    for i in range(wl['replicas']):
        properties = {'rid'  : i,
                      'temp' : 123.45 + float(i / 10),
                      'foo'  : 'bar'}
        replica = rr.Replica(workload=wl, properties=properties)
        replicas.append(replica)

    # create and run the replica exchange ensemble
    exchange = rr.Exchange(replicas=replicas,
                           replica_cycles=wl['cycles'],
                           selection_criteria=wl['criteria'])
    exchange.run()
    exchange.terminate()


# ------------------------------------------------------------------------------

